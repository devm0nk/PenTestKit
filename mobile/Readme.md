## Pwning Mobile Applications

#### Device

- Android Studio
  - https://developer.android.com/studio

---

#### Root AVDs - Android Studio

- https://gitlab.com/newbit/rootAVD

```
./rootAVD.sh ListAllAVDs
```

```
./rootAVD.sh system-images/android-xx/google_apis_playstore/x86_64/ramdisk.img
```

---

#### Check if rooted

```
adb shell
emu64xa:/ $ su
emu64xa:/ # whoami
```

#### Automatically add user certificates to the system root CA store

- https://github.com/NVISOsecurity/MagiskTrustUserCerts/

---

#### Reboot Device

```
adb -e reboot
```

---

#### Start emulator with Burp Proxy

```
emulator -avd Pixel_XX_API_YY -http-proxy http://127.0.0.1:8080
```

---

#### Setup DNS server

```
emulator @PixelX_API_YY -dns-server 8.8.8.8
```

---

#### Use Kali Linux to connect to a Windows host emulator

- Change VM connection to Bridged

```
adb devices
adb -s emulator-5554 tcpip 5555
ipconfig
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=5555 connectaddress=127.0.0.1 connectport=5555
netsh interface portproxy delete v4tov4 listenport=5555 listenaddress=0.0.0.0
adb connect <windows_host_ip>:5555
```

---

#### APK extraction

```
adb shell pm list packages | findstr xxxx
adb shell pm path <package_name>
adb pull /path/to/file.apk
```

---

#### Decompile APK

```
apktool d <apk_file>
```

---

